var X=Object.defineProperty;var z=(r,t,e)=>t in r?X(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var a=(r,t,e)=>(z(r,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const y of o.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&s(y)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();function c(r,t){if(!r)throw new Error(t??"Assertion failed.")}let h,i;function Q(){h=document.getElementById("app"),h.oncontextmenu=t=>t.preventDefault();const r=h.getContext("webgl2",{desynchronized:!1,antialias:!0});c(r,"Failed to initialize WebGL 2"),i=r,I()}function x(){return h.width}function u(){return h.height}function I(){const r=h.height/h.width,t=Math.min(h.width,window.innerWidth),e=t*r;h.style.width=`${t}px`,h.style.height=`${e}px`}let O;function N(r){I(),O(r),requestAnimationFrame(N)}function H(r){O=r,requestAnimationFrame(N)}function R(){const r=i.createBuffer();return c(r,"Failed to create WebGL buffer"),r}function K(){const r=i.createVertexArray();return c(r,"Failed to create WebGL vertex array"),r}function $(r,t){const e=i.getUniformLocation(r,t);return c(e,"Failed to get WebGL uniform location"),e}function q(r,t){const e=i.createProgram();c(e,"Failed to create WebGL program");const s=D(i.VERTEX_SHADER,r),n=D(i.FRAGMENT_SHADER,t);i.attachShader(e,s),i.attachShader(e,n),i.linkProgram(e);const o=i.getProgramInfoLog(e);return o&&o.length>0&&console.log("Program linkage log: "+o),c(i.getProgramParameter(e,i.LINK_STATUS),"Failed to link program"),i.deleteShader(s),i.deleteShader(n),e}function D(r,t){const e=i.createShader(r);c(e,"Failed to create WebGL shader"),i.shaderSource(e,t),i.compileShader(e);const s=i.getShaderInfoLog(e);return s&&s.length>0&&console.log(`Shader compilation log: ${s}

Shader source: ${t}`),c(i.getShaderParameter(e,i.COMPILE_STATUS),"Failed to compile shader"),e}var M=(r=>(r[r.Left=0]="Left",r))(M||{});class V{constructor(){a(this,"downFrame",0)}}const w=new Map,b=new Map;function k(r){let t=w.get(r.code);t||(t=new V,t.downFrame=p,w.set(r.code,t))}function j(r){w.delete(r.code)}function J(r){let t=b.get(r.button);t||(t=new V,t.downFrame=p,b.set(r.button,t))}function Z(r){b.delete(r.button)}function tt(){window.addEventListener("keydown",k),window.addEventListener("keyup",j),window.addEventListener("pointerdown",J),window.addEventListener("pointerup",Z)}function m(r){const t=w.get(r);return(t==null?void 0:t.downFrame)===p}function et(r){const t=b.get(r);return(t==null?void 0:t.downFrame)===p}const A=[];let v;function C(){const r=i.createTexture();return c(r,"Failed to create WebGL texture"),r}function it(){v=C(),i.bindTexture(i.TEXTURE_2D,v),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),i.bindTexture(i.TEXTURE_2D,null)}function rt(r){const t=C(),e=new Image;return e.onload=()=>{A.push({texture:t,image:e})},e.src=r,t}function st(){for(const r of A){const t=r.image;i.bindTexture(i.TEXTURE_2D,r.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t.width,t.height,0,i.RGBA,i.UNSIGNED_BYTE,t)}i.bindTexture(i.TEXTURE_2D,null),A.length=0}const nt=`#version 300 es\r
\r
layout(location = 0) in vec2 position;\r
layout(location = 1) in vec4 inColor;\r
uniform vec2 viewportSize;\r
\r
out vec4 color;\r
\r
void main() {\r
    gl_Position = vec4(\r
        position.x / (viewportSize.x / 2.0) - 1.0,\r
        position.y / (viewportSize.y / 2.0) - 1.0,\r
        1.0,\r
        1.0\r
    );\r
    color = inColor;\r
}\r
`,ot=`#version 300 es\r
precision highp float;\r
\r
in vec4 color;\r
uniform sampler2D currentTexture;\r
\r
out vec4 outColor;\r
\r
void main() {\r
    outColor = color;\r
}\r
`,L=4,at=6,E=1024;let f=null,G;function ct(){return f||(f=q(nt,ot),G=$(f,"viewportSize"),f)}class ht{constructor(){a(this,"vao");a(this,"positionBuffer");a(this,"colorBuffer");a(this,"indexBuffer");a(this,"positions",new Float32Array(L*2*E));a(this,"colors",new Uint32Array(L*E));a(this,"indices",new Uint16Array(at*E));a(this,"numVertices",0);a(this,"numIndices",0);a(this,"started",!1);this.vao=K(),this.positionBuffer=R(),this.colorBuffer=R(),this.indexBuffer=R(),i.bindVertexArray(this.vao),i.bindBuffer(i.ARRAY_BUFFER,this.positionBuffer),i.bufferData(i.ARRAY_BUFFER,this.positions.length,i.DYNAMIC_DRAW),i.enableVertexAttribArray(0),i.vertexAttribPointer(0,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.colorBuffer),i.bufferData(i.ARRAY_BUFFER,this.colors.length,i.DYNAMIC_DRAW),i.enableVertexAttribArray(1),i.vertexAttribPointer(1,4,i.UNSIGNED_BYTE,!0,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.indices.length,i.DYNAMIC_DRAW),i.bindVertexArray(null)}begin(){c(!this.started),this.started=!0}vertex(t,e,s){let n=this.numVertices*2;this.positions[n++]=t,this.positions[n++]=e,this.colors[this.numVertices]=s,++this.numVertices}colorQuadCorners(t,e,s,n,o=4294967295){c(this.started),this.indices[this.numIndices++]=this.numVertices+0,this.indices[this.numIndices++]=this.numVertices+1,this.indices[this.numIndices++]=this.numVertices+2,this.indices[this.numIndices++]=this.numVertices+1,this.indices[this.numIndices++]=this.numVertices+2,this.indices[this.numIndices++]=this.numVertices+3,this.vertex(t,e,o),this.vertex(t,n,o),this.vertex(s,e,o),this.vertex(s,n,o)}colorQuad(t,e,s,n,o=4294967295){c(this.started),this.colorQuadCorners(t,e,t+s,e+n,o)}end(){c(this.started),i.bindTexture(i.TEXTURE_2D,v),i.bindBuffer(i.ARRAY_BUFFER,this.positionBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.positions,0,this.numVertices*2),i.bindBuffer(i.ARRAY_BUFFER,this.colorBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.colors,0,this.numVertices),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,this.indices,0,this.numIndices),i.useProgram(ct()),i.uniform2f(G,x(),u()),i.bindVertexArray(this.vao),i.drawElements(i.TRIANGLES,this.numIndices,i.UNSIGNED_SHORT,0),i.bindVertexArray(null),i.bindTexture(i.TEXTURE_2D,null),this.numVertices=0,this.numIndices=0,this.started=!1}}function g(){return Math.random()*2**32>>>0}class F{constructor(t,e,s,n){this.a=t,this.b=e,this.c=s,this.d=n,c((t|e|s|n)!==0,"At least one value must be non-zero")}static newRandom(){let t=0,e=0,s=0,n=0;for(;!(t|e|s|n);)t=g(),e=g(),s=g(),n=g();return new F(t,e,s,n)}nextFloat(){let t=this.b<<9,e=this.b*5;return e=(e<<7|e>>>25)*9,this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=t,this.d=this.d<<11|this.d>>>21,(e>>>0)/4294967296}nextFloatBetween(t,e){return t+this.nextFloat()*(e-t)}}function ut(r){const t=document.createElement("audio");return t.src=r,t}let W;function lt(){rt("/flappy-bird/test.png"),W=ut("/flappy-bird/score.wav")}class B{constructor(t=0,e=0,s=0,n=0){this.x=t,this.y=e,this.width=s,this.height=n}containsPoint(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height}containsRect(t){return this.containsPoint(t.x,t.y)||this.containsPoint(t.x+t.width,t.y)||this.containsPoint(t.x,t.y+t.height)||this.containsPoint(t.x+t.width,t.y+t.height)}}const T=150,dt=-15,l=20;class ft{constructor(){a(this,"y",0);a(this,"vy",0);this.reset()}get x(){return T}reset(){this.y=(u()-l)/2,this.vy=0}calcRect(){return new B(this.x,this.y,l,l)}update(t,e){this.vy+=dt,e&&(this.vy=400);let s=0;return this.y+=this.vy*t,this.y+l>=u()?(this.y=u()-l,this.vy=0):this.y<=0&&(this.y=0,this.vy=0,s=1),s}draw(t){t.colorQuad(this.x,this.y,l,l)}}const U=180,pt=-100,mt=100;var d=(r=>(r[r.No=0]="No",r[r.Yes=1]="Yes",r))(d||{});class _{constructor(t,e){a(this,"x",0);a(this,"gapOffsetY",0);a(this,"scored",!1);this.x=t,this.reset(e)}get vx(){return-180}get centerX(){return this.x+this.width/2}get width(){return 70}containsRect(t){for(const e of this.calcRects())if(e.containsRect(t))return!0;return!1}calcRects(){const e=u()/2+this.gapOffsetY-U/2,s=e+U;return[new B(this.x,0,this.width,e),new B(this.x,s,this.width,u()-s)]}reset(t){this.gapOffsetY=t.nextFloatBetween(pt,mt),this.scored=!1}update(t){return this.x+=this.vx*t,!this.scored&&this.centerX<=T?(this.scored=!0,1):0}draw(t){for(const e of this.calcRects())t.colorQuad(e.x,e.y,e.width,e.height,4278255360)}}const P=200,gt=300;class wt{constructor(t){a(this,"obstacles",[]);this.random=t,this.reset()}reset(){this.obstacles.length=0,this.obstacles.push(new _(T+gt,this.random))}getNearestObstacle(t){let e=this.obstacles[0],s=1/0;for(const n of this.obstacles){const o=Math.abs(t-n.centerX);o<s&&(e=n,s=o)}return e}getFarthestObstacle(){let t=this.obstacles[0];for(let e=1;e<this.obstacles.length;++e){const s=this.obstacles[e];s.x>=t.x&&(t=s)}return t}reuseObstacle(t){t.x=this.getFarthestObstacle().x+P,t.reset(this.random)}spawnObstacles(){let t=this.getFarthestObstacle();for(;t.x<=x();)t=new _(t.x+P,this.random),this.obstacles.push(t)}update(t){let e=d.No;for(const s of this.obstacles)s.update(t)===d.Yes&&(c(e===d.No),e=d.Yes),s.x+s.width<0&&this.reuseObstacle(s);return e}draw(t){for(const e of this.obstacles)e.draw(t)}}class bt{constructor(){a(this,"started",!1);a(this,"score",0);a(this,"died",!1);a(this,"spriteBatch",new ht);a(this,"player",new ft);a(this,"obstacleManager",new wt(new F(100,200,300,400)));lt(),this.reset()}reset(){this.died=!1,this.player.reset(),this.obstacleManager.reset(),this.started=!1,this.score=0}update(t){let e=m("Space")||m("Enter")||m("W")||m("ArrowUp")||et(M.Left);if(this.died){if(!e)return;e=!1,this.reset()}if(this.obstacleManager.spawnObstacles(),!this.started&&(this.started=e,!this.started))return;const s=this.player.update(t,e);this.obstacleManager.update(t)===d.Yes&&(this.score+=1,W.play(),console.log("Score:",this.score));const n=this.obstacleManager.getNearestObstacle(this.player.x);(s||n.containsRect(this.player.calcRect()))&&(console.log("Died"),this.died=!0)}draw(){this.spriteBatch.begin(),this.player.draw(this.spriteBatch),this.obstacleManager.draw(this.spriteBatch),this.died&&this.spriteBatch.colorQuad(100,100,x()-200,u()-200),this.spriteBatch.end()}}let p=0,S,Y=performance.now()/1e3;function xt(r){let t=r-Y;t>1/20&&(t=1/20),Y=r,st(),S.update(t)}function yt(r){xt(r/1e3),i.viewport(0,0,x(),u()),i.clearColor(0,0,0,1),i.clear(i.COLOR_BUFFER_BIT),S.draw(),++p}function Rt(){Q(),tt(),it(),S=new bt,H(yt)}document.addEventListener("DOMContentLoaded",Rt);
