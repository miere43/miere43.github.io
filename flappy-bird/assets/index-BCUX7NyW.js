var z=Object.defineProperty;var Q=(i,t,e)=>t in i?z(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var a=(i,t,e)=>(Q(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const R of o.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&n(R)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();const F=document.getElementById("debug-overlay");function m(i){F.append(i),F.append(`
`)}function H(){F.innerHTML=""}function c(i,t){if(!i)throw new Error(t??"Assertion failed.")}let h,r;function K(){h=document.getElementById("app"),h.oncontextmenu=t=>t.preventDefault();const i=h.getContext("webgl2",{desynchronized:!1,antialias:!0});c(i,"Failed to initialize WebGL 2"),r=i,M()}function x(){return h.width}function u(){return h.height}function M(){const i=h.height/h.width,t=Math.min(h.width,window.innerWidth),e=t*i;h.style.width=`${t}px`,h.style.height=`${e}px`}let N;function V(i){M(),N(i),requestAnimationFrame(V)}function k(i){N=i,requestAnimationFrame(V)}function E(){const i=r.createBuffer();return c(i,"Failed to create WebGL buffer"),i}function q(){const i=r.createVertexArray();return c(i,"Failed to create WebGL vertex array"),i}function j(i,t){const e=r.getUniformLocation(i,t);return c(e,"Failed to get WebGL uniform location"),e}function J(i,t){const e=r.createProgram();c(e,"Failed to create WebGL program");const n=U(r.VERTEX_SHADER,i),s=U(r.FRAGMENT_SHADER,t);r.attachShader(e,n),r.attachShader(e,s),r.linkProgram(e);const o=r.getProgramInfoLog(e);return o&&o.length>0&&console.log("Program linkage log: "+o),c(r.getProgramParameter(e,r.LINK_STATUS),"Failed to link program"),r.deleteShader(n),r.deleteShader(s),e}function U(i,t){const e=r.createShader(i);c(e,"Failed to create WebGL shader"),r.shaderSource(e,t),r.compileShader(e);const n=r.getShaderInfoLog(e);return n&&n.length>0&&console.log(`Shader compilation log: ${n}

Shader source: ${t}`),c(r.getShaderParameter(e,r.COMPILE_STATUS),"Failed to compile shader"),e}var C=(i=>(i[i.Left=0]="Left",i))(C||{});class G{constructor(){a(this,"downFrame",0)}}const g=new Map,w=new Map;function Z(){for(const i of g)m(`Key down: ${i[0]} (frame ${i[1].downFrame})`);for(const i of w)m(`Mouse button down: ${i[0]} (frame ${i[1].downFrame})`)}function tt(i){let t=g.get(i.code);t||(t=new G,t.downFrame=f,g.set(i.code,t))}function et(i){g.delete(i.code)}function rt(i){let t=w.get(i.button);t||(t=new G,t.downFrame=f,w.set(i.button,t))}function it(i){w.delete(i.button)}function nt(){window.addEventListener("keydown",tt),window.addEventListener("keyup",et),window.addEventListener("pointerdown",rt),window.addEventListener("pointerup",it)}function b(i){const t=g.get(i);return(t==null?void 0:t.downFrame)===f}function st(i){const t=w.get(i);return(t==null?void 0:t.downFrame)===f}const v=[];let B;function W(){const i=r.createTexture();return c(i,"Failed to create WebGL texture"),i}function ot(){B=W(),r.bindTexture(r.TEXTURE_2D,B),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),r.bindTexture(r.TEXTURE_2D,null)}function at(i){const t=W(),e=new Image;return e.onload=()=>{v.push({texture:t,image:e})},e.src=i,t}function ct(){for(const i of v){const t=i.image;r.bindTexture(r.TEXTURE_2D,i.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t.width,t.height,0,r.RGBA,r.UNSIGNED_BYTE,t)}r.bindTexture(r.TEXTURE_2D,null),v.length=0}const ht=`#version 300 es\r
\r
layout(location = 0) in vec2 position;\r
layout(location = 1) in vec4 inColor;\r
uniform vec2 viewportSize;\r
\r
out vec4 color;\r
\r
void main() {\r
    gl_Position = vec4(\r
        position.x / (viewportSize.x / 2.0) - 1.0,\r
        position.y / (viewportSize.y / 2.0) - 1.0,\r
        1.0,\r
        1.0\r
    );\r
    color = inColor;\r
}\r
`,ut=`#version 300 es\r
precision highp float;\r
\r
in vec4 color;\r
uniform sampler2D currentTexture;\r
\r
out vec4 outColor;\r
\r
void main() {\r
    outColor = color;\r
}\r
`,_=4,dt=6,A=1024;let p=null,X;function lt(){return p||(p=J(ht,ut),X=j(p,"viewportSize"),p)}class ft{constructor(){a(this,"vao");a(this,"positionBuffer");a(this,"colorBuffer");a(this,"indexBuffer");a(this,"positions",new Float32Array(_*2*A));a(this,"colors",new Uint32Array(_*A));a(this,"indices",new Uint16Array(dt*A));a(this,"numVertices",0);a(this,"numIndices",0);a(this,"started",!1);this.vao=q(),this.positionBuffer=E(),this.colorBuffer=E(),this.indexBuffer=E(),r.bindVertexArray(this.vao),r.bindBuffer(r.ARRAY_BUFFER,this.positionBuffer),r.bufferData(r.ARRAY_BUFFER,this.positions.length,r.DYNAMIC_DRAW),r.enableVertexAttribArray(0),r.vertexAttribPointer(0,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.colorBuffer),r.bufferData(r.ARRAY_BUFFER,this.colors.length,r.DYNAMIC_DRAW),r.enableVertexAttribArray(1),r.vertexAttribPointer(1,4,r.UNSIGNED_BYTE,!0,0,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,this.indices.length,r.DYNAMIC_DRAW),r.bindVertexArray(null)}begin(){c(!this.started),this.started=!0}vertex(t,e,n){let s=this.numVertices*2;this.positions[s++]=t,this.positions[s++]=e,this.colors[this.numVertices]=n,++this.numVertices}colorQuadCorners(t,e,n,s,o=4294967295){c(this.started),this.indices[this.numIndices++]=this.numVertices+0,this.indices[this.numIndices++]=this.numVertices+1,this.indices[this.numIndices++]=this.numVertices+2,this.indices[this.numIndices++]=this.numVertices+1,this.indices[this.numIndices++]=this.numVertices+2,this.indices[this.numIndices++]=this.numVertices+3,this.vertex(t,e,o),this.vertex(t,s,o),this.vertex(n,e,o),this.vertex(n,s,o)}colorQuad(t,e,n,s,o=4294967295){c(this.started),this.colorQuadCorners(t,e,t+n,e+s,o)}end(){c(this.started),r.bindTexture(r.TEXTURE_2D,B),r.bindBuffer(r.ARRAY_BUFFER,this.positionBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,this.positions,0,this.numVertices*2),r.bindBuffer(r.ARRAY_BUFFER,this.colorBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,this.colors,0,this.numVertices),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,this.indices,0,this.numIndices),r.useProgram(lt()),r.uniform2f(X,x(),u()),r.bindVertexArray(this.vao),r.drawElements(r.TRIANGLES,this.numIndices,r.UNSIGNED_SHORT,0),r.bindVertexArray(null),r.bindTexture(r.TEXTURE_2D,null),this.numVertices=0,this.numIndices=0,this.started=!1}}function y(){return Math.random()*2**32>>>0}class S{constructor(t,e,n,s){this.a=t,this.b=e,this.c=n,this.d=s,c((t|e|n|s)!==0,"At least one value must be non-zero")}static newRandom(){let t=0,e=0,n=0,s=0;for(;!(t|e|n|s);)t=y(),e=y(),n=y(),s=y();return new S(t,e,n,s)}nextFloat(){let t=this.b<<9,e=this.b*5;return e=(e<<7|e>>>25)*9,this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=t,this.d=this.d<<11|this.d>>>21,(e>>>0)/4294967296}nextFloatBetween(t,e){return t+this.nextFloat()*(e-t)}}function pt(i){const t=document.createElement("audio");return t.src=i,t}let $;function mt(){at("/flappy-bird/test.png"),$=pt("/flappy-bird/score.wav")}class T{constructor(t=0,e=0,n=0,s=0){this.x=t,this.y=e,this.width=n,this.height=s}containsPoint(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height}containsRect(t){return this.containsPoint(t.x,t.y)||this.containsPoint(t.x+t.width,t.y)||this.containsPoint(t.x,t.y+t.height)||this.containsPoint(t.x+t.width,t.y+t.height)}}const D=150,gt=-900,d=20;class wt{constructor(){a(this,"y",0);a(this,"vy",0);this.reset()}get x(){return D}reset(){this.y=(u()-d)/2,this.vy=0}calcRect(){return new T(this.x,this.y,d,d)}update(t,e){this.vy+=gt*t,e&&(this.vy=400);let n=0;return this.y+=this.vy*t,this.y+d>=u()?(this.y=u()-d,this.vy=0):this.y<=0&&(this.y=0,this.vy=0,n=1),n}draw(t){t.colorQuad(this.x,this.y,d,d)}}const I=180,bt=-100,yt=100;var l=(i=>(i[i.No=0]="No",i[i.Yes=1]="Yes",i))(l||{});class P{constructor(t,e){a(this,"x",0);a(this,"gapOffsetY",0);a(this,"scored",!1);this.x=t,this.reset(e)}get vx(){return-180}get centerX(){return this.x+this.width/2}get width(){return 70}containsRect(t){for(const e of this.calcRects())if(e.containsRect(t))return!0;return!1}calcRects(){const e=u()/2+this.gapOffsetY-I/2,n=e+I;return[new T(this.x,0,this.width,e),new T(this.x,n,this.width,u()-n)]}reset(t){this.gapOffsetY=t.nextFloatBetween(bt,yt),this.scored=!1}update(t){return this.x+=this.vx*t,!this.scored&&this.centerX<=D?(this.scored=!0,1):0}draw(t){for(const e of this.calcRects())t.colorQuad(e.x,e.y,e.width,e.height,4278255360)}}const Y=200,xt=300;class Rt{constructor(t){a(this,"obstacles",[]);this.random=t,this.reset()}reset(){this.obstacles.length=0,this.obstacles.push(new P(D+xt,this.random))}getNearestObstacle(t){let e=this.obstacles[0],n=1/0;for(const s of this.obstacles){const o=Math.abs(t-s.centerX);o<n&&(e=s,n=o)}return e}getFarthestObstacle(){let t=this.obstacles[0];for(let e=1;e<this.obstacles.length;++e){const n=this.obstacles[e];n.x>=t.x&&(t=n)}return t}reuseObstacle(t){t.x=this.getFarthestObstacle().x+Y,t.reset(this.random)}spawnObstacles(){let t=this.getFarthestObstacle();for(;t.x<=x();)t=new P(t.x+Y,this.random),this.obstacles.push(t)}update(t){let e=l.No;for(const n of this.obstacles)n.update(t)===l.Yes&&(c(e===l.No),e=l.Yes),n.x+n.width<0&&this.reuseObstacle(n);return e}draw(t){for(const e of this.obstacles)e.draw(t)}}class Et{constructor(){a(this,"started",!1);a(this,"score",0);a(this,"died",!1);a(this,"spriteBatch",new ft);a(this,"player",new wt);a(this,"obstacleManager",new Rt(new S(100,200,300,400)));mt(),this.reset()}reset(){this.died=!1,this.player.reset(),this.obstacleManager.reset(),this.started=!1,this.score=0}update(t){let e=b("Space")||b("Enter")||b("W")||b("ArrowUp")||st(C.Left);if(this.died){if(!e)return;e=!1,this.reset()}if(this.obstacleManager.spawnObstacles(),!this.started&&(this.started=e,!this.started))return;const n=this.player.update(t,e);this.obstacleManager.update(t)===l.Yes&&(this.score+=1,$.play(),console.log("Score:",this.score));const s=this.obstacleManager.getNearestObstacle(this.player.x);(n||s.containsRect(this.player.calcRect()))&&(console.log("Died"),this.died=!0)}draw(){this.spriteBatch.begin(),this.player.draw(this.spriteBatch),this.obstacleManager.draw(this.spriteBatch),this.died&&this.spriteBatch.colorQuad(100,100,x()-200,u()-200),m(`Score: ${this.score}`),this.spriteBatch.end()}}let f=0,L,O=performance.now()/1e3;function At(i){let t=i-O;t>1/20&&(t=1/20),O=i,m(`FPS: ${(1/t).toFixed(0)}`),Z(),ct(),L.update(t)}function Ft(i){H(),m(`Frame: ${f}`),At(i/1e3),r.viewport(0,0,x(),u()),r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT),L.draw(),++f}function vt(){K(),nt(),ot(),L=new Et,k(Ft)}document.addEventListener("DOMContentLoaded",vt);
