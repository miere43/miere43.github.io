var yt=Object.defineProperty;var vt=(i,t,e)=>t in i?yt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var a=(i,t,e)=>(vt(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();const Q=document.getElementById("debug-overlay");function X(i){Q.append(i),Q.append(`
`)}function At(){Q.innerHTML=""}function h(i,t){if(!i)throw new Error(t??"Assertion failed.")}let l,r;function Bt(){l=document.getElementById("app"),l.oncontextmenu=t=>t.preventDefault();const i=l.getContext("webgl2",{desynchronized:!1,antialias:!0});h(i,"Failed to initialize WebGL 2"),r=i,r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),at()}function b(){return l.width}function f(){return l.height}function at(){const i=l.height/l.width,t=Math.min(l.width,window.innerWidth),e=t*i;l.style.width=`${t}px`,l.style.height=`${e}px`}let ct;function ht(i){at(),ct(i),requestAnimationFrame(ht)}function St(i){ct=i,requestAnimationFrame(ht)}function C(){const i=r.createBuffer();return h(i,"Failed to create WebGL buffer"),i}function Ft(){const i=r.createVertexArray();return h(i,"Failed to create WebGL vertex array"),i}function Z(i,t){const e=r.getUniformLocation(i,t);return h(e,"Failed to get WebGL uniform location"),e}function Ut(i,t){const e=r.createProgram();h(e,"Failed to create WebGL program");const n=tt(r.VERTEX_SHADER,i),s=tt(r.FRAGMENT_SHADER,t);r.attachShader(e,n),r.attachShader(e,s),r.linkProgram(e);const o=r.getProgramInfoLog(e);return o&&o.length>0&&console.log("Program linkage log: "+o),h(r.getProgramParameter(e,r.LINK_STATUS),"Failed to link program"),r.deleteShader(n),r.deleteShader(s),e}function tt(i,t){const e=r.createShader(i);h(e,"Failed to create WebGL shader"),r.shaderSource(e,t),r.compileShader(e);const n=r.getShaderInfoLog(e);return n&&n.length>0&&console.log(`Shader compilation log: ${n}

Shader source: ${t}`),h(r.getShaderParameter(e,r.COMPILE_STATUS),"Failed to compile shader"),e}var ut=(i=>(i[i.Left=0]="Left",i))(ut||{});class dt{constructor(){a(this,"downFrame",0)}}const y=new Map,v=new Map;function _t(){for(const i of y)X(`Key down: ${i[0]} (frame ${i[1].downFrame})`);for(const i of v)X(`Mouse button down: ${i[0]} (frame ${i[1].downFrame})`)}function Dt(){y.clear(),v.clear()}function It(i){let t=y.get(i.code);t||(t=new dt,t.downFrame=B,y.set(i.code,t))}function Ct(i){y.delete(i.code)}function Lt(i){i.pointerType!=="mouse"&&lt(i)}function Pt(i){i.pointerType!=="mouse"&&ft(i)}function lt(i){let t=v.get(i.button);t||(t=new dt,t.downFrame=B,v.set(i.button,t))}function ft(i){v.delete(i.button)}function Ot(i){i.preventDefault()}function Yt(i){i.preventDefault()}function Nt(){window.addEventListener("keydown",It),window.addEventListener("keyup",Ct),window.addEventListener("pointerdown",Lt),window.addEventListener("pointerup",Pt),window.addEventListener("mousedown",lt),window.addEventListener("mouseup",ft),window.addEventListener("touchstart",Ot,{passive:!1}),window.addEventListener("touchend",Yt,{passive:!1})}function L(i){const t=y.get(i);return(t==null?void 0:t.downFrame)===B}function Mt(i){const t=v.get(i);return(t==null?void 0:t.downFrame)===B}function Xt(i,t,e){return 4278190080|(e&255)<<16|(t&255)<<8|i&255}class A{constructor(t=0,e=0,n=0,s=0){this.x=t,this.y=e,this.width=n,this.height=s}containsPoint(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height}containsRect(t){return this.containsPoint(t.x,t.y)||this.containsPoint(t.x+t.width,t.y)||this.containsPoint(t.x,t.y+t.height)||this.containsPoint(t.x+t.width,t.y+t.height)}}let Gt=class{constructor(t,e){this.width=t,this.height=e}};const $=[];let R;function pt(){const i=r.createTexture();return h(i,"Failed to create WebGL texture"),i}function z(i){const t=i!=null&&i.repeat?r.REPEAT:r.CLAMP_TO_EDGE;r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)}function Vt(){R={handle:pt(),width:1,height:1},r.bindTexture(r.TEXTURE_2D,R.handle),z(void 0),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),r.bindTexture(r.TEXTURE_2D,null)}function U(i,t){const e={handle:pt(),width:1,height:1};r.bindTexture(r.TEXTURE_2D,e.handle),z(t),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),r.bindTexture(r.TEXTURE_2D,null);const n=new Image;return n.onload=()=>{$.push({texture:e,image:n,options:t})},n.src=i,e}function kt(){for(const i of $){const t=i.image;i.texture.width=t.width,i.texture.height=t.height,r.bindTexture(r.TEXTURE_2D,i.texture.handle),z(i.options),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t.width,t.height,0,r.RGBA,r.UNSIGNED_BYTE,t)}r.bindTexture(r.TEXTURE_2D,null),$.length=0}const Wt=`#version 300 es\r
\r
layout(location = 0) in vec2 position;\r
layout(location = 1) in vec4 inColor;\r
layout(location = 2) in vec2 inTexCoord;\r
uniform vec2 viewportSize;\r
\r
out vec4 color;\r
out vec2 texCoord;\r
\r
void main() {\r
    gl_Position = vec4(\r
        position.x / (viewportSize.x / 2.0) - 1.0,\r
        position.y / (viewportSize.y / 2.0) - 1.0,\r
        1.0,\r
        1.0\r
    );\r
    color = inColor;\r
    texCoord = inTexCoord;\r
}\r
`,Qt=`#version 300 es\r
precision highp float;\r
\r
in vec4 color;\r
in vec2 texCoord;\r
uniform sampler2D currentTexture;\r
\r
out vec4 outColor;\r
\r
void main() {\r
    outColor = texture(currentTexture, texCoord) * color;\r
}\r
`,W=4,$t=6,P=1024;let T=null,gt,wt;function zt(){return T||(T=Ut(Wt,Qt),gt=Z(T,"viewportSize"),wt=Z(T,"currentTexture"),T)}var G=(i=>(i[i.BottomLeft=0]="BottomLeft",i[i.Center=1]="Center",i))(G||{});class Ht{constructor(){a(this,"vao");a(this,"positionBuffer");a(this,"colorBuffer");a(this,"texCoordBuffer");a(this,"indexBuffer");a(this,"positions",new Float32Array(W*2*P));a(this,"colors",new Uint32Array(W*P));a(this,"texCoords",new Float32Array(W*2*P));a(this,"indices",new Uint16Array($t*P));a(this,"numVertices",0);a(this,"numIndices",0);a(this,"started",!1);a(this,"currentTexture",R);this.vao=Ft(),this.positionBuffer=C(),this.colorBuffer=C(),this.texCoordBuffer=C(),this.indexBuffer=C(),r.bindVertexArray(this.vao),r.bindBuffer(r.ARRAY_BUFFER,this.positionBuffer),r.bufferData(r.ARRAY_BUFFER,this.positions.length,r.DYNAMIC_DRAW),r.enableVertexAttribArray(0),r.vertexAttribPointer(0,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.colorBuffer),r.bufferData(r.ARRAY_BUFFER,this.colors.length,r.DYNAMIC_DRAW),r.enableVertexAttribArray(1),r.vertexAttribPointer(1,4,r.UNSIGNED_BYTE,!0,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.texCoordBuffer),r.bufferData(r.ARRAY_BUFFER,this.texCoords.length,r.DYNAMIC_DRAW),r.enableVertexAttribArray(2),r.vertexAttribPointer(2,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,this.indices.length,r.DYNAMIC_DRAW),r.bindVertexArray(null)}begin(){h(!this.started),this.started=!0}vertex(t,e,n,s,o){let c=this.numVertices*2;this.positions[c]=t,this.positions[c+1]=e,this.colors[this.numVertices]=o,this.texCoords[c]=n,this.texCoords[c+1]=s,++this.numVertices}quadIndices(){this.indices[this.numIndices++]=this.numVertices+0,this.indices[this.numIndices++]=this.numVertices+1,this.indices[this.numIndices++]=this.numVertices+2,this.indices[this.numIndices++]=this.numVertices+1,this.indices[this.numIndices++]=this.numVertices+2,this.indices[this.numIndices++]=this.numVertices+3}quadCorners(t,e,n,s,o){this.quadIndices(),this.vertex(t,e,0,0,o),this.vertex(t,s,0,1,o),this.vertex(n,e,1,0,o),this.vertex(n,s,1,1,o)}colorQuadCorners(t,e,n,s,o=4294967295){h(this.started),this.switchTexture(R),this.quadCorners(t,e,n,s,o)}colorQuad(t,e,n,s,o=4294967295){this.colorQuadCorners(t,e,t+n,e+s,o)}colorRect(t,e=4294967295){this.colorQuad(t.x,t.y,t.width,t.height,e)}textureQuadCorners(t,e,n,s,o,c=4294967295){h(this.started),this.switchTexture(o),this.quadCorners(t,e,n,s,c)}textureQuad(t,e,n,s,o,c=4294967295){this.textureQuadCorners(t,e,t+n,e+s,o,c)}textureQuadTexCoord(t,e,n,s,o,c=4294967295){this.textureQuadCorners(t,e,t+n,e+s,o,c)}textureQuadRepeating(t,e,n,s,o,c,D,p,g,d=4294967295){h(this.started),this.switchTexture(g),this.quadIndices();const I=t+n,u=e+s,w=D/o,m=p/c,S=w+n/o,F=m+s/c;this.vertex(t,e,w,m,d),this.vertex(t,u,w,F,d),this.vertex(I,e,S,m,d),this.vertex(I,u,S,F,d)}measureText(t,e){let n=0;for(let s=0;s<e.length;++s){const o=e.charCodeAt(s),c=t.chars.get(o);c&&(n+=c.advanceX)}return new Gt(n,t.base)}drawTextRect(t,e,n,s=4294967295,o=0){if(h(this.started),n.length===0)return;this.switchTexture(e.texture);const c=1/e.texture.width,D=1/e.texture.height;let p,g;switch(o){case 0:p=t.x,g=t.y;break;case 1:const d=this.measureText(e,n);p=t.x+t.width/2-d.width/2,g=t.y+t.height/2-d.height/2;break;default:h(!1)}p=Math.floor(p),g=Math.floor(g);for(let d=0;d<n.length;++d){const I=n.charCodeAt(d),u=e.chars.get(I);if(!u)continue;const w=p+u.offsetX,m=g-u.offsetY+e.base-u.height,S=w+u.width,F=m+u.height,V=u.x*c,k=(e.texture.height-u.y-u.height)*D,j=V+u.width*c,J=k+u.height*D;this.quadIndices(),this.vertex(w,m,V,k,s),this.vertex(w,F,V,J,s),this.vertex(S,m,j,k,s),this.vertex(S,F,j,J,s),p+=u.advanceX}}drawText(t,e,n,s,o=4294967295){this.drawTextRect(new A(t,e,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),n,s,o)}switchTexture(t){this.currentTexture!==t&&(this.commit(!0),this.currentTexture=t)}commit(t){h(this.started),this.numVertices>0&&(r.bindBuffer(r.ARRAY_BUFFER,this.positionBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,this.positions,0,this.numVertices*2),r.bindBuffer(r.ARRAY_BUFFER,this.colorBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,this.colors,0,this.numVertices),r.bindBuffer(r.ARRAY_BUFFER,this.texCoordBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,this.texCoords,0,this.numVertices*2),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,this.indices,0,this.numIndices),r.useProgram(zt()),r.uniform2f(gt,b(),f()),r.uniform1i(wt,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.currentTexture.handle),r.bindVertexArray(this.vao),r.drawElements(r.TRIANGLES,this.numIndices,r.UNSIGNED_SHORT,0),r.bindVertexArray(null),r.bindTexture(r.TEXTURE_2D,null)),this.numVertices=0,this.numIndices=0,this.started=!1,t&&this.begin()}end(){this.commit(!1),this.currentTexture=R}}function O(){return Math.random()*2**32>>>0}class H{constructor(t,e,n,s){this.a=t,this.b=e,this.c=n,this.d=s,h((t|e|n|s)!==0,"At least one value must be non-zero")}static newRandom(){let t=0,e=0,n=0,s=0;for(;!(t|e|n|s);)t=O(),e=O(),n=O(),s=O();return new H(t,e,n,s)}nextFloat(){let t=this.b<<9,e=this.b*5;return e=(e<<7|e>>>25)*9,this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=t,this.d=this.d<<11|this.d>>>21,(e>>>0)/4294967296}nextFloatBetween(t,e){return t+this.nextFloat()*(e-t)}}function et(i){const t=document.createElement("audio");return t.src=i,t}const qt=new TextDecoder("utf-8");class Kt{constructor(t){a(this,"view");a(this,"offset",0);this.view=new DataView(t)}get done(){return this.offset>=this.view.byteLength}readInt16(){const t=this.view.getInt16(this.offset,!0);return this.offset+=2,t}readUint8(){const t=this.view.getUint8(this.offset);return this.offset+=1,t}readUint16(){const t=this.view.getUint16(this.offset,!0);return this.offset+=2,t}readUint32(){const t=this.view.getUint32(this.offset,!0);return this.offset+=4,t}readCString(){let t=this.offset;for(;!this.done;)if(this.readUint8()===0)return qt.decode(this.view.buffer.slice(t,this.offset));throw new Error("missing null terminator")}}class rt{constructor(t){a(this,"texture",R);a(this,"lineHeight",0);a(this,"base",0);a(this,"chars",new Map);fetch(t).then(e=>(h(e.ok),e.arrayBuffer())).then(this.load.bind(this))}load(t){const e=new Kt(t);for(h(e.readUint32()===54938946);!e.done;){const n=e.readUint8(),s=e.readUint32(),o=e.offset+s;switch(n){case 2:this.lineHeight=e.readUint16(),this.base=e.readUint16();break;case 3:this.texture=U(`/flappy-bird/${e.readCString()}`);break;case 4:for(;e.offset<o;){const c=e.readUint32();this.chars.set(c,{x:e.readUint16(),y:e.readUint16(),width:e.readUint16(),height:e.readUint16(),offsetX:e.readInt16(),offsetY:e.readInt16(),advanceX:e.readInt16()}),e.offset+=2}break}e.offset=o}}}let mt,xt,bt,Y,Tt,N,M,Et;function jt(){mt=U("/flappy-bird/test.png"),xt=U("/flappy-bird/obstacle.png"),bt=U("/flappy-bird/background.png",{repeat:!0}),Y=U("/flappy-bird/ground.png",{repeat:!0}),Tt=et("/flappy-bird/score.wav"),N=et("/flappy-bird/player-hit-obstacle.ogg"),M=new rt("/flappy-bird/font.fnt"),Et=new rt("/flappy-bird/font-big.fnt")}class Jt{draw(t,e,n){const s=new A(100,100,b()-200,f()-200);t.colorRect(s),t.drawTextRect(s,M,`Final score: ${e}`,4294967295,G.Center),s.y-=M.lineHeight*2,t.drawTextRect(s,M,`Best score: ${n}`,4294967295,G.Center)}}const q=150,Zt=-900,x=20;class te{constructor(){a(this,"y",0);a(this,"vy",0);this.reset()}get x(){return q}reset(){this.y=(f()-x)/2,this.vy=0}calcRect(){return new A(this.x,this.y,x,x)}update(t,e){this.vy+=Zt*t,e&&(this.vy=400);let n=0;return this.y+=this.vy*t,this.y+x>=f()?(this.y=f()-x,this.vy=0):this.y<=_&&(this.y=_,this.vy=0,n=1),n}draw(t){t.textureQuad(this.x,this.y,x,x,mt)}}const it=180,ee=-100,re=100,Rt=-180;var E=(i=>(i[i.No=0]="No",i[i.Yes=1]="Yes",i))(E||{});class nt{constructor(t,e){a(this,"x",0);a(this,"gapOffsetY",0);a(this,"scored",!1);this.x=t,this.reset(e)}get centerX(){return this.x+this.width/2}get width(){return 70}containsRect(t){for(const e of this.calcRects())if(e.containsRect(t))return!0;return!1}calcRects(){const e=f()/2+this.gapOffsetY-it/2,n=e+it;return[new A(this.x,_,this.width,e-_),new A(this.x,n,this.width,f()-n)]}reset(t){this.gapOffsetY=t.nextFloatBetween(ee,re),this.scored=!1}update(t){return this.x+=Rt*t,!this.scored&&this.centerX<=q?(this.scored=!0,1):0}draw(t){for(const e of this.calcRects())t.textureQuad(e.x,e.y,e.width,e.height,xt)}}const st=200,ie=300;class ne{constructor(t){a(this,"obstacles",[]);this.random=t,this.reset()}reset(){this.obstacles.length=0,this.obstacles.push(new nt(q+ie,this.random))}getNearestObstacle(t){let e=this.obstacles[0],n=1/0;for(const s of this.obstacles){const o=Math.abs(t-s.centerX);o<n&&(e=s,n=o)}return e}getFarthestObstacle(){let t=this.obstacles[0];for(let e=1;e<this.obstacles.length;++e){const n=this.obstacles[e];n.x>=t.x&&(t=n)}return t}reuseObstacle(t){t.x=this.getFarthestObstacle().x+st,t.reset(this.random)}spawnObstacles(){let t=this.getFarthestObstacle();for(;t.x<=b();)t=new nt(t.x+st,this.random),this.obstacles.push(t)}update(t){let e=E.No;for(const n of this.obstacles)n.update(t)===E.Yes&&(h(e===E.No),e=E.Yes),n.x+n.width<0&&this.reuseObstacle(n);return e}draw(t){for(const e of this.obstacles)e.draw(t)}}const _=120;class se{constructor(){a(this,"score",0);a(this,"bestScore",0);a(this,"backgroundX",0);a(this,"spriteBatch",new Ht);a(this,"player",new te);a(this,"obstacleManager",new ne(new H(100,200,300,400)));a(this,"gameOver",new Jt);a(this,"state",0);jt(),this.loadBestScore(),this.reset()}saveBestScore(){localStorage.setItem("flappyBirdBestScore",this.bestScore.toString())}loadBestScore(){const t=localStorage.getItem("flappyBirdBestScore");this.bestScore=t&&t.length>0?Number.parseInt(t):0}reset(){this.player.reset(),this.obstacleManager.reset(),this.score=0,this.backgroundX=0,this.state=0,N.pause(),N.currentTime=0}updateWaitForStart(t){this.state===0&&t&&(this.state=1)}updateGameplay(t,e){if(this.state!==1)return;const n=this.player.update(t,e);this.backgroundX-=Rt*t,this.obstacleManager.update(t)===E.Yes&&(this.score+=1,Tt.play());const s=this.obstacleManager.getNearestObstacle(this.player.x);(n||s.containsRect(this.player.calcRect()))&&(this.bestScore=Math.max(this.bestScore,this.score),this.saveBestScore(),this.player.vy=0,N.play(),this.state=2)}updateGameOverScreen(t){return this.state!==3?t:t&&(this.reset(),!1)}updateGameOverAnimation(t){if(this.state!==2)return;this.player.update(t,!1)&&(this.state=3)}update(t){this.obstacleManager.spawnObstacles();let e=L("Space")||L("Enter")||L("W")||L("ArrowUp")||Mt(ut.Left);this.updateGameOverAnimation(t),e=this.updateGameOverScreen(e),this.updateWaitForStart(e),this.updateGameplay(t,e)}drawGameOverScreen(){this.state===3&&this.gameOver.draw(this.spriteBatch,this.score,this.bestScore)}draw(){this.spriteBatch.begin(),this.spriteBatch.textureQuadRepeating(0,0,b(),f(),64,64,this.backgroundX,0,bt),this.spriteBatch.textureQuadRepeating(0,0,b(),_,Y.width,Y.height,this.backgroundX+10,0,Y),this.obstacleManager.draw(this.spriteBatch),this.player.draw(this.spriteBatch),this.drawGameOverScreen(),this.spriteBatch.drawTextRect(new A(0,f()-200,b(),200),Et,this.score.toString(),Xt(255,255,255),G.Center),this.spriteBatch.end()}}let B=0,K,ot=performance.now()/1e3;function oe(i){let t=i-ot;t>1/20&&(t=1/20),ot=i,X(`FPS: ${(1/t).toFixed(0)}`),_t(),kt(),K.update(t)}function ae(i){At(),X(`Frame: ${B}`),oe(i/1e3),r.viewport(0,0,b(),f()),r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT),K.draw(),++B}function ce(){document.hidden&&Dt()}function he(){Bt(),Nt(),Vt(),document.addEventListener("visibilitychange",ce),K=new se,St(ae)}document.addEventListener("DOMContentLoaded",he);
